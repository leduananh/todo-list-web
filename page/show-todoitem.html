<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todoitem</title>
    <script type="module">
        import { loadHtmlUtil } from '../src/util/loadHtml.js'
        import { header } from '../src/component/header.js'
        // Dùng để load bootstrap file tự động không cần copy paste 
        loadHtmlUtil.loadDefaultBootstrapsCss()

        document.addEventListener('DOMContentLoaded', () => {
            // dùng để load những đoạn html bị lặp lại nhiều trang như header, footer
            loadHtmlUtil.render(header.selector, header.html, { name: 'hello' })
        })
    </script>
</head>

<body>
    <header id="header-section">
    </header>
    <span>Danh sách các công việc của: <b id="show-todoname"></b> trong <b id="show-subname"></b>  </span> 
    <ul id="danh-muc-todoitem"></ul>

    <script type="module">
        import { subCategoryService } from '../src/service/subCategoryService.js'
        import { categoryService } from '../src/service/categoryService.js'
        import { commonUtil } from '../src/util/common.js'
        import { todoItemService } from '../src/service/todoItemService.js'
        import { checkBox } from '../src/util/CheckBox.js'

        window.categoryService = categoryService
        window.subCategoryService = subCategoryService
        window.commonUtil = commonUtil

        let data = commonUtil.loadQueryParamValueByQueryName('data')
        const objectTodo = JSON.parse(decodeURIComponent(data))
       

        const ListTodoItem = todoItemService.getAllTodoItemByTodoName(objectTodo.name)

        document.addEventListener('DOMContentLoaded', function (e) {
            let ct = ''
            // vòng lặp for of
            if (ListTodoItem.length > 0) {
                for (let Todo of ListTodoItem) {
            const categoryItemHtmlStringTemplate = `
                    
                        <li style="font-size: 20px "> Nội dung: <b style=" color: blue">${Todo.title}</b> </li>
                        <p>
                        <div> ID: ${Todo.id} </div>
                        <div> Check box đã hoàn thành:  <input type="checkbox" id="${Todo.id}" class="check"> </div>
                        <div> Ngày bắt đầu: ${Todo.createdDate} </div>
                        <div> Ngày hết hạn: ${Todo.dueDate} </div>
                        </p>
                      `
                    ct = ct + categoryItemHtmlStringTemplate
                }
                if (ListTodoItem.length === 0) {
                ct = '<h1>No subcategory</h1>'}
            }
            const ulTag = document.querySelector('#danh-muc-todoitem');

            ulTag.innerHTML = ct
                
            var checkboxes = document.querySelectorAll('.check');

                checkboxes.forEach(function(checkbox) {
                    checkbox.addEventListener('change', function() {
                        if (this.checked) {
                            alert(this.nextSibling.textContent.trim() + 'Đã hoàn thành');
                            checkBox.saveData()
                        } else {
                            alert(this.nextSibling.textContent.trim() + 'Chưa hoàn thành');
                            checkBox.saveData()
                        }
                    });
                });
                window.onload = function() {
                    checkBox.loadData()
                }

                })
        document.querySelector('#show-todoname').innerText = objectTodo.name     
        document.querySelector('#show-subname').innerText = objectTodo.subCategoryName  
        
        
        

        // let listSubCat = subCategoryService.getAllSubCategoryByCategoryName(categoryName)
        // document.querySelector('#show-sub').innerHTML = `${JSON.stringify(listSubCat)}`
    </script>
  
</body>

</html>